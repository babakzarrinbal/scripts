#!/bin/bash

# List pods and store them in a variable
pods=$(kubectl get pods --no-headers -o custom-columns="NAME:.metadata.name,READY:.status.containerStatuses[*].ready,STATUS:.status.phase,RESTARTS:.status.containerStatuses[*].restartCount,AGE:.metadata.creationTimestamp")

# Use fzf to select a pod
selected_pod=$(echo "$pods" | fzf --prompt="Select a pod: " --header="NAME                               READY   STATUS    RESTARTS   AGE" | awk '{print $1}')

# If a pod is selected, show menu for actions
if [ -n "$selected_pod" ]; then
  action=$(echo -e "Logs\nExec\nDelete" | fzf --prompt="Select an action for $selected_pod: ")
  
  if [ "$action" == "Logs" ]; then
    kubectl logs "$selected_pod" -f --all-containers=true
  elif [ "$action" == "Exec" ]; then
    kubectl exec -it "$selected_pod" -- sh
  elif [ "$action" == "Delete" ]; then
    read -p "Are you sure you want to delete pod $selected_pod? (y/n): " confirm
    if [ "$confirm" == "y" ]; then
      kubectl delete pod "$selected_pod"
    else
      echo "Deletion cancelled."
    fi
  else
    echo "Invalid action selected."
  fi
else
  echo "No pod selected."
fi
